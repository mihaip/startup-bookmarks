<!DOCTYPE html>
<html>
<head>
	<title>Startup Bookmarks Options</title>
	<script src="data.js"></script>
	<style>
	  body {
	    font-family: Helvetica, sans-serif;
	    font-size: 13px;
	    margin: 0;
	  }

	  h1 {
	    margin-top: 0;
	    background: #eee;
	    padding: .5em;
	    border-bottom: solid 1px #ccc;
	  }

    h2 {
      border-bottom: solid 1px #ccc;
      padding-left: 8px;
    }

    .container {
      margin: 8px;
    }
  </style>
</head>
<body>

<h1>Startup Bookmarks</h1>

<form onsubmit="savePrefs(); return false" class="container">
  <label>
    At startup, open: <select id="bookmark-selector"></select>
  </label>

  <input type="submit" value="Save">
</form>

<script>
  function htmlEscape(str) {
    return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
  }

  function populateSelector(indentLevel, bookmarks) {
    var indent = new Array(indentLevel + 1).join('&nbsp;&nbsp;&nbsp;&nbsp;');
    var selectorNode = document.getElementById('bookmark-selector');

    bookmarks.forEach(function(bookmark) {
      if (!bookmark.children || !bookmark.children.length) {
        return;
      }

      var optionNode = document.createElement('option');
      if (indentLevel == 0) {
        optionNode.textContent = '';
        optionNode.value = 'none';
      } else {
        optionNode.innerHTML = indent + htmlEscape(bookmark.title);
        optionNode.value = bookmark.id;
      }
      selectorNode.appendChild(optionNode);

      if (bookmark.id == data.getStartupBookmarkId()) {
        selectorNode.selectedIndex = selectorNode.options.length - 1;
      }

      populateSelector(indentLevel + 1, bookmark.children);
    });
  }

  function savePrefs() {
    var selectorNode = document.getElementById('bookmark-selector');
    var startupBookmarkId = selectorNode.value;
    if (startupBookmarkId == 'none') {
      startupBookmarkId = undefined;
    }
    data.setStartupBookmarkId(startupBookmarkId);
  }

  chrome.bookmarks.getTree(populateSelector.bind(this, 0));
</script>
</body>
</html>
